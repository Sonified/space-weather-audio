<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IRIS Data Audification (Beta) üöß</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üåã</text></svg>">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/fzstd@0.1.1/umd/index.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>IRIS Data Audification (Beta) üöß</h1>
        
        <div class="panel">
            <div class="controls">
                <div class="control-group">
                    <label for="volcano">Volcano:</label>
                    <select id="volcano" onchange="loadStations()">
                        <option value="kilauea">Kƒ´lauea (HI)</option>
                        <option value="maunaloa">Mauna Loa (HI)</option>
                        <option value="greatsitkin">Great Sitkin (AK)</option>
                        <option value="shishaldin">Shishaldin (AK)</option>
                        <option value="spurr">Mount Spurr (AK)</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="dataType">Data Type:</label>
                    <select id="dataType" onchange="updateStationList()">
                        <option value="seismic">Seismic (Z-component)</option>
                        <option value="infrasound">Infrasound</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="station">Station (by distance):</label>
                    <select id="station" style="min-width: 300px;">
                        <option value="">Loading stations...</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="duration">Duration:</label>
                    <select id="duration">
                        <option value="0.5" selected>30 minutes</option>
                        <option value="1">1 hour</option>
                        <option value="2">2 hours</option>
                        <option value="4">4 hours</option>
                        <option value="6">6 hours</option>
                        <option value="12">12 hours</option>
                        <option value="24">24 hours</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <button type="button" id="purgeCacheBtn" onclick="purgeCloudflareCache()" style="padding: 8px 16px; font-size: 14px; min-width: auto;">üóëÔ∏è Purge CDN Cache</button>
                </div>
                
                <div style="display: flex; align-items: center; gap: 8px;">
                    <input type="checkbox" id="bypassCache" style="width: 20px; height: 20px; cursor: pointer;">
                    <label for="bypassCache" style="margin-bottom: 0; cursor: pointer; font-weight: 700; font-size: 14px; color: #333;">Bypass CDN Cache</label>
                </div>
                
                <div class="control-group" style="display: none;">
                    <label for="baseSampleRate">Base Sampling Rate:</label>
                    <select id="baseSampleRate">
                        <option value="44100" selected>44.1 kHz (441x)</option>
                        <option value="48000">48 kHz (480x)</option>
                        <option value="50000">50 kHz (500x)</option>
                        <option value="96000">96 kHz (960x)</option>
                        <option value="192000">192 kHz (1920x)</option>
                        <option value="200000">200 kHz (2000x)</option>
                        <option value="441000">441 kHz (4410x)</option>
                        <option value="1000000">1 MHz (10000x)</option>
                    </select>
                </div>
                
                <div class="control-group" style="display: none;">
                    <button type="button" id="antiAliasingBtn" onclick="toggleAntiAliasing()" class="loop-active" style="padding: 8px 16px; font-size: 14px; min-width: auto;">üéõÔ∏è Anti-Alias: ON</button>
                </div>
                
                <div class="control-group" style="display: none;">
                    <label for="highpassFreq" id="highpassLabel">High Pass (@ 44.1k):</label>
                    <select id="highpassFreq">
                        <option value="none">None</option>
                        <option value="0.01">0.01 Hz</option>
                        <option value="0.02" selected>0.02 Hz</option>
                        <option value="0.045">0.045 Hz</option>
                    </select>
                </div>
                
                <div style="display: none;">
                    <input type="checkbox" id="enableNormalize" checked style="width: 24px; height: 24px; cursor: pointer;">
                    <label for="enableNormalize" style="margin-bottom: 0; cursor: pointer; font-weight: 700; font-size: 18px; color: #333;">Normalization</label>
                </div>
            </div>
            
            <div class="status info" id="status" style="margin-top: 15px;">
                Ready to stream. Select a volcano and station above.
            </div>
        </div>
        
        <div class="panel">
            <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap; width: 100%; box-sizing: border-box;">
                <button type="button" id="startBtn" onclick="startStreaming(event)" style="min-width: 150px;">üì° Fetch Data</button>
                <button type="button" onclick="togglePlayPause()" id="playPauseBtn" disabled style="min-width: 150px;">‚è∏Ô∏è Pause</button>
                <button type="button" onclick="toggleLoop()" id="loopBtn" disabled style="min-width: 150px;">üîÅ Loop</button>
                <div style="display: flex; align-items: center; flex: 1 1 auto; min-width: 200px; max-width: min(600px, 100%); gap: 10px; padding: 0 20px; box-sizing: border-box;">
                    <label for="playbackSpeed" id="speedLabel" style="font-weight: 600; white-space: nowrap; font-size: 18px; flex-shrink: 0; cursor: pointer; user-select: none;" title="Click to reset to 1.0x">Speed: <span id="speedValue">1.0x</span></label>
                    <input type="range" id="playbackSpeed" min="0" max="1000" step="1" value="667" oninput="changePlaybackSpeed()" style="flex: 1; min-width: 0;">
                </div>
                <div style="display: flex; align-items: center; flex: 1 1 auto; min-width: 200px; max-width: min(400px, 100%); gap: 10px; padding: 0 20px; box-sizing: border-box;">
                    <label for="volumeSlider" id="volumeLabel" style="font-weight: 600; white-space: nowrap; font-size: 18px; flex-shrink: 0; cursor: pointer; user-select: none;" title="Click to reset to 1.0">Volume: <span id="volumeValue">1.0</span></label>
                    <input type="range" id="volumeSlider" min="0" max="200" step="1" value="100" oninput="changeVolume()" style="flex: 1; min-width: 0;">
                </div>
                <div style="display: flex; align-items: center; flex: 1 1 auto; min-width: 200px; max-width: min(500px, 100%); gap: 10px; padding: 0 20px; box-sizing: border-box;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; user-select: none;">
                        <input type="checkbox" id="removeDCOffset" onchange="changeWaveformFilter()" checked style="width: 20px; height: 20px; cursor: pointer;">
                        <span style="font-weight: 600; white-space: nowrap; font-size: 18px;">Drift Removal:</span>
                    </label>
                    <label for="waveformFilterSlider" id="waveformFilterLabel" style="font-weight: 600; white-space: nowrap; font-size: 18px; flex-shrink: 0; cursor: pointer; user-select: none;" title="Adjust drift removal aggressiveness"><span id="waveformFilterValue">0.9974</span></label>
                    <input type="range" id="waveformFilterSlider" min="0" max="100" step="1" value="95" oninput="changeWaveformFilter()" style="flex: 1; min-width: 0;">
                </div>
            </div>
        </div>
        
        <div class="panel">
            <canvas id="waveform" width="1200" height="135"></canvas>
            <canvas id="spectrogram" width="1200" height="450"></canvas>
            <div style="display: flex; align-items: center; justify-content: flex-end; gap: 10px; margin-top: 10px; padding: 8px 0; padding-right: 40px;">
                <label for="spectrogramScrollSpeed" style="font-size: 14px; font-weight: 700; white-space: nowrap; user-select: none; color: #ffe8e8; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);">Scroll Speed:</label>
                <div style="position: relative; width: 150px; height: 20px;">
                    <input type="range" id="spectrogramScrollSpeed" min="0" max="100" step="1" value="67" style="width: 150px; position: absolute; left: 0; top: 0;" title="Spectrogram scroll speed">
                    <span id="spectrogramScrollSpeedValue" style="font-size: 14px; font-weight: 700; position: absolute; left: 158px; top: 50%; transform: translateY(-50%); white-space: nowrap; color: #ffe8e8; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);">1.0x</span>
                </div>
            </div>
        </div>
        
        <div class="panel">
            <div class="metrics">
                <div class="metric">
                    <div class="metric-label">Time to First Audio</div>
                    <div class="metric-value" id="ttfa">--</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Download Size</div>
                    <div class="metric-value" id="downloadSize">--</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Sample Count</div>
                    <div class="metric-value" id="sampleCount">--</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Current Position</div>
                    <div class="metric-value" id="currentPosition">0m 0s</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Playback Duration</div>
                    <div class="metric-value" id="playbackDuration">--</div>
                </div>
            </div>
        </div>
        
        <!-- Simulate Row -->
        <div class="panel" style="padding: 15px 20px;">
            <div style="display: flex; gap: 15px; align-items: center;">
                <label style="font-weight: 700; font-size: 16px; color: #333; margin: 0;">Simulate:</label>
                <button type="button" onclick="openParticipantModal()" style="padding: 10px 20px; font-size: 14px; min-width: auto;">üë§ Participant Setup</button>
                <button type="button" onclick="openPrePostSurveyModal()" style="padding: 10px 20px; font-size: 14px; min-width: auto;">üìä Pre/Post Survey</button>
            </div>
        </div>
    </div>
    
    <!-- Participant Setup Modal -->
    <div id="participantModal" class="modal-overlay" onclick="closeParticipantModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">Welcome</h3>
                <button class="modal-close" onclick="closeParticipantModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 20px; color: #333; font-size: 16px;">Enter your participant ID number to begin:</p>
                <div class="modal-form-group">
                    <label for="participantId" style="display: none;">Participant ID/Number:</label>
                    <input type="text" id="participantId" placeholder="Enter participant identifier">
                </div>
                <button type="button" class="modal-submit" onclick="submitParticipantSetup()">‚úì Start Session</button>
            </div>
        </div>
    </div>
    
    <!-- Pre/Post Survey Modal -->
    <div id="prePostSurveyModal" class="modal-overlay" onclick="closePrePostSurveyModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">üìä Pre/Post Survey</h3>
                <button class="modal-close" onclick="closePrePostSurveyModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="mood-survey-intro">Right now, I feel:</div>
                
                <!-- Scale header labels -->
                <div class="survey-scale-labels">
                    <div></div>
                    <div class="survey-scale-labels-grid">
                        <span>Not at all</span>
                        <span>A lit&shy;tle</span>
                        <span>Mod&shy;er&shy;ate</span>
                        <span>Quite a bit</span>
                        <span>Very much</span>
                    </div>
                </div>
                
                <div class="mood-scale-container">
                <!-- Calm -->
                <div class="mood-scale-item">
                    <div class="mood-scale-label">Calm</div>
                    <div class="mood-scale-options">
                        <div class="mood-scale-option">
                            <input type="radio" name="calm" id="calm1" value="1">
                            <label for="calm1">1</label>
                        </div>
                        <div class="mood-scale-option">
                            <input type="radio" name="calm" id="calm2" value="2">
                            <label for="calm2">2</label>
                        </div>
                        <div class="mood-scale-option">
                            <input type="radio" name="calm" id="calm3" value="3">
                            <label for="calm3">3</label>
                        </div>
                        <div class="mood-scale-option">
                            <input type="radio" name="calm" id="calm4" value="4">
                            <label for="calm4">4</label>
                        </div>
                        <div class="mood-scale-option">
                            <input type="radio" name="calm" id="calm5" value="5">
                            <label for="calm5">5</label>
                        </div>
                    </div>
                </div>
                
                <!-- Energized -->
                <div class="mood-scale-item">
                    <div class="mood-scale-label">Energized</div>
                    <div class="mood-scale-options">
                        <div class="mood-scale-option">
                            <input type="radio" name="energized" id="energized1" value="1">
                            <label for="energized1">1</label>
                        </div>
                        <div class="mood-scale-option">
                            <input type="radio" name="energized" id="energized2" value="2">
                            <label for="energized2">2</label>
                        </div>
                        <div class="mood-scale-option">
                            <input type="radio" name="energized" id="energized3" value="3">
                            <label for="energized3">3</label>
                        </div>
                        <div class="mood-scale-option">
                            <input type="radio" name="energized" id="energized4" value="4">
                            <label for="energized4">4</label>
                        </div>
                        <div class="mood-scale-option">
                            <input type="radio" name="energized" id="energized5" value="5">
                            <label for="energized5">5</label>
                        </div>
                    </div>
                </div>
                
                <!-- Connected -->
                <div class="mood-scale-item">
                    <div class="mood-scale-label">Connected</div>
                    <div class="mood-scale-options">
                        <div class="mood-scale-option">
                            <input type="radio" name="connected" id="connected1" value="1">
                            <label for="connected1">1</label>
                        </div>
                        <div class="mood-scale-option">
                            <input type="radio" name="connected" id="connected2" value="2">
                            <label for="connected2">2</label>
                        </div>
                        <div class="mood-scale-option">
                            <input type="radio" name="connected" id="connected3" value="3">
                            <label for="connected3">3</label>
                        </div>
                        <div class="mood-scale-option">
                            <input type="radio" name="connected" id="connected4" value="4">
                            <label for="connected4">4</label>
                        </div>
                        <div class="mood-scale-option">
                            <input type="radio" name="connected" id="connected5" value="5">
                            <label for="connected5">5</label>
                        </div>
                    </div>
                </div>
                
                <!-- Stressed -->
                <div class="mood-scale-item">
                    <div class="mood-scale-label">Stressed</div>
                    <div class="mood-scale-options">
                        <div class="mood-scale-option">
                            <input type="radio" name="stressed" id="stressed1" value="1">
                            <label for="stressed1">1</label>
                        </div>
                        <div class="mood-scale-option">
                            <input type="radio" name="stressed" id="stressed2" value="2">
                            <label for="stressed2">2</label>
                        </div>
                        <div class="mood-scale-option">
                            <input type="radio" name="stressed" id="stressed3" value="3">
                            <label for="stressed3">3</label>
                        </div>
                        <div class="mood-scale-option">
                            <input type="radio" name="stressed" id="stressed4" value="4">
                            <label for="stressed4">4</label>
                        </div>
                        <div class="mood-scale-option">
                            <input type="radio" name="stressed" id="stressed5" value="5">
                            <label for="stressed5">5</label>
                        </div>
                    </div>
                </div>
                
                <!-- Focused -->
                <div class="mood-scale-item">
                    <div class="mood-scale-label">Focused</div>
                    <div class="mood-scale-options">
                        <div class="mood-scale-option">
                            <input type="radio" name="focused" id="focused1" value="1">
                            <label for="focused1">1</label>
                        </div>
                        <div class="mood-scale-option">
                            <input type="radio" name="focused" id="focused2" value="2">
                            <label for="focused2">2</label>
                        </div>
                        <div class="mood-scale-option">
                            <input type="radio" name="focused" id="focused3" value="3">
                            <label for="focused3">3</label>
                        </div>
                        <div class="mood-scale-option">
                            <input type="radio" name="focused" id="focused4" value="4">
                            <label for="focused4">4</label>
                        </div>
                        <div class="mood-scale-option">
                            <input type="radio" name="focused" id="focused5" value="5">
                            <label for="focused5">5</label>
                        </div>
                    </div>
                </div>
                
                <!-- Sense of Wonder -->
                <div class="mood-scale-item">
                    <div class="mood-scale-label">Sense of Wonder</div>
                    <div class="mood-scale-options">
                        <div class="mood-scale-option">
                            <input type="radio" name="wonder" id="wonder1" value="1">
                            <label for="wonder1">1</label>
                        </div>
                        <div class="mood-scale-option">
                            <input type="radio" name="wonder" id="wonder2" value="2">
                            <label for="wonder2">2</label>
                        </div>
                        <div class="mood-scale-option">
                            <input type="radio" name="wonder" id="wonder3" value="3">
                            <label for="wonder3">3</label>
                        </div>
                        <div class="mood-scale-option">
                            <input type="radio" name="wonder" id="wonder4" value="4">
                            <label for="wonder4">4</label>
                        </div>
                        <div class="mood-scale-option">
                            <input type="radio" name="wonder" id="wonder5" value="5">
                            <label for="wonder5">5</label>
                        </div>
                    </div>
                </div>
                </div>
                
                <button type="button" class="modal-submit" onclick="submitPrePostSurvey()">‚úì Submit Survey</button>
            </div>
        </div>
    </div>
    
    <!-- ES6 Module Imports - Refactored Architecture ‚ú® -->
    <script type="module" src="js/main.js"></script>
</body>
</html>
